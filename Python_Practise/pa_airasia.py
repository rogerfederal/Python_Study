import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
import re
from time import sleep
from multiprocessing import Process
from bs4 import BeautifulSoup
import datetime

try:
    begin = datetime.date(2018,7,2)
    end = datetime.date(2018,12,31)
    for i in range((end - begin).days+1):
        day = begin + datetime.timedelta(days=i)
        url = 'https://booking.airasia.com/Flight/Select?o1=XIY&d1=DMK&culture=zh-CN&dd1={}&ADT=4&CHD=1&s=true&mon=true&cc=CNY&c=false'.format(str(day))
        header = {"User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36","Cookie":'__gads=ID=1e5ed6fe39c76023:T=1470489958:S=ALNI_MZpvR5JCzx0u7BpIx9iBnFpvxn_Ig; optimizelySegments=%7B%222413280347%22%3A%22referral%22%2C%222418030232%22%3A%22none%22%2C%222421210230%22%3A%22gc%22%2C%222440830185%22%3A%22false%22%7D; optimizelyBuckets=%7B%7D; _ga=GA1.3.382211461.1469712980; s_rsid=aa-airasia-member-prd; _ga=GA1.2.382211461.1469712980; __airasiaga=GA1.2.382211461.1469712980; optimizelyEndUserId=oeu1469712919275r0.11608153713894831; rxVisitor=15111914219037DPIA0KL3V4JH99OC9554NH091AT7R9K; AA_ISREMEMBERME=3065482@qq.com; _umdata=0712F33290AB8A6D254FB74A06A9D08E53A5AA58DBF81C404EF48B4ADEAD614B50F00548A5F56DB2CD43AD3E795C914CA4A8C724F5B48D3287E4318A0F8AA185; i10c.uid=1517666662973:9599; _clientId=GA1.2.382211461.1469712980; dcp_recommendation=XIY|SYD; dcp_last_search=XIY|SYD|2019-03-03; dcp_last_search_with_date=2019|3|XIY|SYD; dcp_last_search_with_date_next=2019|4|XIY|SYD; dcp_last_search_with_date_prev=2019|2|XIY|SYD; dcp_route=XIY|SYD|XIY; _hp2_props.3785637731=%7B%22Logged%20In%22%3A%22true%22%2C%22Event%20-%20AirasiaGA%20ID%22%3A%22GA1.2.382211461.1469712980%22%2C%22Event%20-%20Dotrez%20Signature%22%3A%22TDhXMU5VcVVJQVE9fGxVZUg2SS9OYXpsZGNnZXpzaXB1cXNxcGJ1aitDTFhrdW5HZzg0R3cwZXBKeWVXNEhuamlwcm54NXRMdFR5ekRXSXZvRzVXVkI5RnBOeTZKdElkTTVSUmtiNTUwRGdJSTJ3TnJONFBwRmp1MVhGdVhzSjU4Rk1Kei9kMmM1T2k5dUJVOEJFWERIYkRHamVGQVZTNlg2RzUyYUVweVZtTFluVXM9%22%7D; _hp2_id.3785637731=%7B%22userId%22%3A%220998580462111805%22%2C%22pageviewId%22%3A%226946849835867226%22%2C%22sessionId%22%3A%224439113788524738%22%2C%22identity%22%3Anull%2C%22transition%22%3Atrue%2C%22trackerVersion%22%3A%223.0%22%7D; LanguageSelect=cn/zh; true_loc=cn; lastOrigin=XIY; lastDestination=DMK; X-CDN-Geo-Country=CN; X-CDN-Geo-City=XIAN; currencySelect=CNY; __airasiaga_gid=GA1.2.378186938.1530539946; acw_tc=AQAAAKdhKiHkuAsA/s9VAc2ADKFEYOye; ASP.NET_SessionId=nubd1jwxwij51xnyoaqo2via; appID=W001; __RequestVerificationToken=fiS3Ju_UTkpFY8fH56qe5BRR7628XPwvyHaYlM4u4fa5DM49JpP_27xM7aAczdqdpwOwMaKVlHOTrk1V3oGM4PdNKiboYb4C3wGyEmZoRTW668gwX8IpogGdCnEVCUVGY9ofTw2; dotrez=1544741898.20480.0000; dtSa=-; acw_sc_=5b3a4f8c5fdaa97b29088cc54abae4f249c6990a; dotRezSignature=T1NhaXYyb3Fhb3JzeHdqMWRidW5DZ2N5bngxNWppd294a2c9fG9MZkFNVmY1SWpiSjRGNU1nYnBzMUNHSDFPMitINjRYbnRKeTBWMXN2bGJlamxMMjBqbzk5MDAyQkNGdzVlUkMvdlBzelhZc1kzbHU0UHM2QnFXM3ZYWnA2bW9CZTFMcUlsd2N2K0NFTTJ0Y1hXMlZ0ZzdHNW5saEtzNjJrb25aZDRQRnQweXpoNUt5aEtVQ1RVaz0=; MCCRate=AA1H1K8C5DIYMSZ|MYR|CNY|1.725200000000000000; userSession=cc=zh-CN&mcc=CNY&rc=WWWA&ad=nubd1jwxwij51xnyoaqo2via&p=&st=1530548112.94395; jaceToken=61871c2e-ab3f-487a-a6f7-496b68a75b29; dtLatC=4; displaySSR=%7B%22departureDate%22:%222018-7-10%22,%22bookingDate%22:%222018-7-3%22%7D; lastDepartureDate=10/07/2018; flightSelect=XIY|DMK|2018-07-10|N; _recent_searches={"recent":[{"origin":"XIY","departlowfare":"2561.00","returnlowfare":"1,131.00","destination":"DMK","departDate":"2018-07-05","returnDate":"2018-07-12","currency":"CNY","flightType":"roundTrip","adult":"4","children":"1","infant":"","timestamp":"2018-07-02T14:00:36.718Z","url":"https://booking.airasia.com/Flight/Select?o1=XIY&d1=DMK&culture=zh-CN&dd1=2018-07-05&dd2=2018-07-12&r=true&ADT=4&CHD=1&s=true&mon=true&cc=CNY&c=false"},{"origin":"XIY","departlowfare":"2561.00","returnlowfare":0,"destination":"DMK","departDate":"2018-07-05","returnDate":"NA","currency":"CNY","flightType":"oneWayTrip","adult":"4","children":"1","infant":"0","timestamp":"2018-07-02T14:18:56.402Z","url":"https://booking.airasia.com/Flight/Select?o1=XIY&d1=DMK&dd1=2018-07-05&ADT=4&CHD=1&inl=0&s=false&mon=true&cc=CNY"},{"origin":"XIY","departlowfare":"1056.00","returnlowfare":0,"destination":"DMK","departDate":"2018-07-10","returnDate":"NA","currency":"CNY","flightType":"oneWayTrip","adult":"4","children":"1","infant":"","timestamp":"2018-07-02T16:15:16.234Z","url":"https://booking.airasia.com/Flight/Select?o1=XIY&d1=DMK&culture=zh-CN&dd1=2018-07-10&ADT=4&CHD=1&s=true&mon=true&cc=CNY&c=false"}]}; displayFare=%7B%22displayFare%22%3A966%2C%22resultsLink%22%3A%22https%3A//booking.airasia.com/Flight/Select%3Fo1%3DXIY%26d1%3DDMK%26culture%3Dzh-CN%26dd1%3D2018-07-10%26ADT%3D4%26CHD%3D1%26s%3Dtrue%26mon%3Dtrue%26cc%3DCNY%26c%3Dfalse%22%2C%22currency%22%3A%22CNY%22%2C%22destinationCity%22%3A%22%25E6%259B%25BC%25E8%25B0%25B7%2520-%2520%25E5%25BB%258A%25E6%259B%25BC%2520%28DMK%29%22%2C%22departureCity%22%3A%22%25E8%25A5%25BF%25E5%25AE%2589%2520%28XIY%29%22%7D; dtPC=5$548112703_913h-vKNLLLNIJDGKGEGDENMABPELOJKEGDHDO; rxvt=1530550010559|1530548112725; dtCookie=5$C88CFA0824E47767EA49F599C953076B|booking.airasia.com|1'}

        session = requests.Session()
        # print("starting get price on {}".format(url))
        response = session.get(url,headers=header,verify=False).text
        # print(response)
        soup = BeautifulSoup(response,"html.parser")
        for price in soup.find_all("div",attrs={"class":"avail-fare-price"}):
            # print(price.text)
            print(str(day),str(price.text).strip())
except:
    print("not available date")